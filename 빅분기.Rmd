---
title: "빅분기R"
author: "wjdekdls"
date: "2023-02-13"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.


```{r}
library(dplyr)
df = read.csv('/Users/jeongdain/Downloads/train.csv')
df
```
```{r}
df %>% mutate(Q1 = fivenum(Fare)[2], Q3= fivenum(Fare)[4], IQR = Q3- Q1) %>% 
  filter((Fare<Q1-1.5*IQR | Q3+1.5*IQR<Fare & Sex == 'female' ))
```

```{r}
# 데이터에서 IQR을 활용해 Fare컬럼의 이상치를 찾고, 이상치 데이터의 여성 수를 구하시오

df %>% mutate(Q1 = fivenum(Fare)[2], Q3= fivenum(Fare)[4], IQR = Q3- Q1) %>% 
  filter((Fare<Q1-1.5*IQR | Q3+1.5*IQR<Fare & Sex == 'female' )) %>% 
  nrow
```



```{r}
# 주어진 데이터에서 이상치(소수점 나이)를 찾고 올림, 내림, 버림(절사)했을때 3가지 모두 이상치 'age' 평균을 구한 다음 모두 더하여 출력

df %>% filter((Fare*10)%%10!=0) %>% 
  mutate(pre1=ceiling(Fare),pre2=floor(Fare),pre3=trunc(Fare)) %>% 
  select(pre1,pre2,pre3)  %>% 
  apply(2,mean) # %>% sum
```

```{r}
# 결측치 생성
apply(is.na(df),2,sum) # f1에 31개
```




주어진 데이터에서 결측치가 80%이상 되는 컬럼은(변수는) 삭제하고, 80% 미만인 결측치가 있는 컬럼은 'city'별 중앙값으로 값을 대체하고 'f1'컬럼의 평균값을 출력하세요!

```{r}
df1 = df %>% group_by(Pclass) %>%
  mutate(pre_f1 = ifelse(is.na(Age), median(Age, na.rm = T), Age))

mean(df1$pre_f1)
mean(df1$Age)
```







```{r}
df = read.csv("/Users/jeongdain/Downloads/basic1.csv", sep = ',', header = T)

# library("readxl")
# my_data <- read_excel("my_file.xlsx", sheet = "data", col_names = T)
```

#'f4'컬럼 값이 'ENFJ'와 'INFP'인 'f1'의 표준편차 차이를 절대값으로 구하시오
```{r}
df %>% filter((f4 == 'ENFJ' | f4 == 'INFP')) %>%
  group_by(f4) %>% summarise(value = sd(f1, na.rm= T)) %>%
  select(value) 
```


# 주어진 데이터 중 basic1.csv에서 'f1'컬럼 결측 데이터를 제거하고, 
'city'와 'f2'을 기준으로 묶어 합계를 구하고, 'city가 경기이면서 f2가 0'인 조건에 만족하는 f1 값을 구하시오

```{r}
df %>% filter(!is.na(f1)) %>% group_by(city,f2) %>% 
  summarise(value=f1, value2= sum(f1)) %>% 
  filter(city=='경기' & f2==0) %>% 
  data.frame %>% select(value)
```



# 'f4'컬럼의 값이 'ESFJ'인 데이터를 'ISFJ'로 대체하고, 'city'가 '경기'이면서 'f4'가 'ISFJ'인 데이터 중 'age'컬럼
```{r}
df %>% mutate(pre_f4=ifelse(f4=='ESFJ','ISFJ',f4)) %>% 
  filter(city=='경기' & pre_f4=='ISFJ') %>% 
  summarise(city, pre_f4, value=age)

df
```

#주어진 데이터에서 'f5'컬럼을 표준화(Standardization (Z-score Normalization))하고 그 중앙값을 구하시오

```{r}
library(caret)
df1 = df %>% filter(!is.na(Age))
```


# 주어진 데이터에서 'f5'컬럼을 표준화(Standardization (Z-score Normalization))하고 그 중앙값을 구해
```{r}
sta=preProcess(df1)
median(predict(sta,df1)$pre_f1,na.rm=T)
```

# min-max스케일링 기준 상하위 5% 구하기
# 주어진 데이터에서 'f5'컬럼을 min-max 스케일 변환한 후, 상위 5%와 하위 5% 값의 합을 구하시오
```{r}
mm=preProcess(df,'range')
df %>% mutate(mm_f5=predict(mm,df)$f5) %>% summarise(v1=quantile(mm_f5,0.95),v2=quantile(mm_f5,0.05)) %>% sum
```



```{r}
library(caret)
my_mode=function(data) {as.numeric(names(which.max(table(data))))}

df1=df %>% mutate(pre_f1=ifelse(is.na(Age),my_mode(Age),Age)) %>%
  filter(Age>=20) %>% reframe(Age, Fare)
df1
```

# 상관관계 구하기
# 주어진 데이터에서 상관관계를 구하고, quality와의 상관관계가 가장 큰 값과, 가장 작은 값을 구한 다음 더하시오!
# 단, quality와 quality 상관관계 제외, 소수점 둘째 자리까지 출력
```{r}
library(dplyr)
df=read.csv('../input/red-wine-quality-cortez-et-al-2009/winequality-red.csv')
df %>% cor %>% data.frame %>% select(quality) %>% arrange(-quality) %>% slice(-1) %>% 
    summarise(MAX=max(quality),MIN=min(quality)) %>% 
    sum %>% round(2)
```



# city와 f4를 기준으로 f5의 평균값을 구한 다음, f5를 기준으로 상위 7개 값을 모두 더해 출력하시오 (소수점 둘째자리까지 출력)
```{r}
library(dplyr)
df=read.csv('../input/bigdatacertificationkr/basic1.csv')
df %>% group_by(city,f4) %>% summarise(value=mean(f5)) %>% 
  arrange(-value) %>% data.frame %>% slice(1:7) %>% 
  summarise(value=sum(value)) %>% round(2)
```



# 주어진 데이터 셋에서 age컬럼 상위 20개의 데이터를 구한 다음 
# f1의 결측치를 중앙값으로 채운다.
# 그리고 f4가 ISFJ와 f5가 20 이상인 
# f1의 평균값을 출력하시오!
```{r}
df %>% arrange(-age) %>% slice(1:20) %>% 
  mutate(pre_f1=ifelse(is.na(f1),median(f1,na.rm=T),f1)) %>% 
  filter(f4=='ISFJ' & f5>=20) %>% 
  summarise(value=mean(pre_f1))
```


# 주어진 데이터 셋에서 f2가 0값인 데이터를 age를 기준으로 오름차순 정렬하고
# 앞에서 부터 20개의 데이터를 추출한 후 
# f1 결측치(최소값)를 채우기 전과 후의 분산 차이를 계산하시오 (소수점 둘째 자리까지)
```{r}
df %>% filter(f2 == 0) %>% arrange(age) %>% slice(1:20) %>% 
  mutate(f1_fill = ifelse(is.na(f1),min(f1,na.rm= T),f1)) %>%
  summarise(be_var = var(f1, na.rm = T), af_var = var(f1_fill)) %>%
  apply(1, diff) %>% abs %>% round(2)
```



# ### 2022년 5월 Sales의 중앙값을 구하시오
```{r}
library(lubridate)
library(dplyr)
df %>% mutate(year=year(Date),month=month(Date)) %>% filter(year==2022 & month==5) %>% summarise(value=median(Sales))
```


# 2022년 5월 Sales의 중앙값을 구하시오
```{r}
df %>% mutate(year=year(Date),month=month(Date)) %>% filter(year==2022 & month==5) %>% summarise(value=median(Sales))

# 그 중에서 Date, Sales
df1= df %>% mutate(year=year(Date),month=month(Date)) %>% filter(year==2022 & month==5) %>% select(Date, Sales) %>% data.frame
```



```{r}
library(dplyr)
library(lubridate)
df=read.csv('../input/bigdatacertificationkr/basic2.csv')
df1=df %>% mutate(year=year(Date),month=month(Date),wday=wday(Date,label=T)) %>% 
  filter(year==2022 & month==5) %>% data.frame

end_mean=df1 %>% filter(wday %in% c('Sat','Sun')) %>% summarise(value=mean(Sales))
day_mean=df1 %>% filter(!(wday %in% c('Sat','Sun'))) %>% summarise(value=mean(Sales))
round(abs(end_mean-day_mean),2)
```



## 주어진 데이터에서 2022년 5월 주말과 평일의 sales컬럼 평균값 차이를 구하시오 (소수점 둘째자리까지 출력, 반올림)
```{r}
library(dplyr)
library(lubridate)
df=read.csv('../input/bigdatacertificationkr/basic2.csv')
df1=df %>% mutate(year=year(Date),month=month(Date),wday=wday(Date,label=T)) %>% filter(year==2022 & month==5) %>% data.frame

end_mean=df1 %>% filter(wday %in% c('Sat','Sun')) # %>% summarise(value=mean(Sales))
day_mean=df1 %>% filter(!(wday %in% c('Sat','Sun'))) # %>% summarise(value=mean(Sales))
```


### basic1 데이터 중 'f4'를 기준으로 basic3 데이터 'f4'값을 기준으로 병합하고, 
### 병합한 데이터에서 r2결측치를 제거한다음, 앞에서 부터 20개 데이터를 선택하고 'f2'컬럼 합을 구하시오
```{r}
library(dplyr)
df1=read.csv('../input/bigdatacertificationkr/basic1.csv')
df2=read.csv('../input/bigdatacertificationkr/basic3.csv')
df1 %>% inner_join(df2,by='f4') %>% filter(r2!='') %>% head(20) %>% summarise(value=sum(f2))
```



## 나이 구간 나누기
###  basic1 데이터 중 'age'컬럼 이상치를 제거하고, 동일한 개수로 나이 순으로 3그룹으로 나눈 뒤 각 그룹의 중앙값을 더하시오
### (이상치는 음수(0포함), 소수점 값)

```{r}
library(dplyr)
library(ggplot2)
df=read.csv('../input/bigdatacertificationkr/basic1.csv')
df %>% filter((age*10)%%10==0 & age>0) %>% 
  mutate(group=cut_number(age,3)) %>% group_by(group) %>% 
  summarise(med=median(age)) %>% 
  summarise(value=sum(med))





library(dplyr)
library(ggplot2)
df=read.csv('../input/bigdatacertificationkr/basic1.csv')
df %>% filter((age*10)%%10==0 & age>0) %>% mutate(group=cut_number(age,3)) %>% 
  group_by(group) %>% mutate(med=median(age)) %>% summarise(value=mean(med))
```


```{r}
### 주어진 데이터(basic2.csv)에서 주 단위 Sales의 합계를 구하고, 가장 큰 값을 가진 주와 작은 값을 가진 주의 차이를 구하시오(절대값)
### 데이터셋 : basic2.csv
### 오른쪽 상단 copy&edit 클릭 -> 예상문제 풀이 시작

library(readr)
library(dplyr)
df=read_csv('../input/bigdatacertificationkr/basic2.csv')
df %>% mutate(week=cut(Date,breaks='week')) %>% group_by(week) %>% summarise(value=sum(Sales)) %>% summarise(MAX=max(value),MIN=min(value)) %>% apply(1,diff) %>% abs
```



